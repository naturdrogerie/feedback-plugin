"use strict";(self.webpackChunkplentymarkets_feedback=self.webpackChunkplentymarkets_feedback||[]).push([[5],{4304:function(e,t,a){a.d(t,{A:function(){return m}});a(8940);let s=!1,i=!1;const r={setFeedbackAuthenticatedUser(e,t){e.authenticatedUser=t},setFeedbackCounts(e,t){e.counts=t},setFeedbacks(e,t){e.feedbacks=e.feedbacks.concat(t)},setFeedbackItemAttributes(e,t){e.itemAttributes=t},setFeedbackPagination(e,t){e.pagination.lastPage=t.lastPage,e.pagination.isLastPage=t.isLastPage},incrementCurrentFeedbackPage(e){e.pagination.currentPage++},addFeedback(e,t){if(e.authenticatedUser.feedbacks.unshift(t),t.isVisible){const a=parseInt(t.feedbackRating.rating.ratingValue);a>0&&a<=5&&(e.counts["ratingsCountOf"+a]++,e.counts.ratingsCountTotal++,u(e))}},deleteFeedback(e,{feedbackId:t,parentFeedbackId:a,feedback:s}){if(s.isVisible&&null===a){const t=parseInt(s.feedbackRating.rating.ratingValue);t>0&&t<=5&&(e.counts["ratingsCountOf"+t]--,e.counts.ratingsCountTotal--,u(e))}null===a?(e.feedbacks=c(e.feedbacks,t),e.authenticatedUser.feedbacks=c(e.authenticatedUser.feedbacks,t)):(e.feedbacks=l(e.feedbacks,a,t),e.authenticatedUser.feedbacks=l(e.authenticatedUser.feedbacks,a,t))}},n={loadFeedbackUser({commit:e},{itemId:t,variationId:a}){if(!i){i=!0;let s="";return void 0!==t&&void 0!==a&&(s=`/${t}/${a}`),$.ajax({type:"GET",url:"/rest/feedbacks/user"+s,success:function(t){e("setFeedbackAuthenticatedUser",t),i=!1},error:function(e,t,a){i=!1,console.error(a)}})}},loadFeedbackCounts({commit:e,state:t},a){if(!d)return d=!0,$.ajax({type:"GET",url:"/rest/feedbacks/feedback/helper/counts/"+a,success:function(t){e("setFeedbackCounts",t.counts)},error:function(e,t,a){console.error(a)}})},loadPaginatedFeedbacks({commit:e,state:t},{itemId:a,feedbacksPerPage:i}){if(!s){s=!0;const r=$.ajax({type:"GET",url:"/rest/feedbacks/feedback/helper/feedbacklist/"+a+"/"+t.pagination.currentPage,data:{feedbacksPerPage:i},success:function(t){e("setFeedbacks",t.feedbacks),e("setFeedbackItemAttributes",t.itemAttributes),e("setFeedbackPagination",t.pagination),s=!1},error:function(e,t,a){console.error(a),s=!1}});return e("incrementCurrentFeedbackPage"),r}},deleteFeedback({commit:e,state:t},{feedbackId:a,parentFeedbackId:s,feedback:i}){return $.ajax({type:"DELETE",url:"/rest/feedbacks/feedback/delete/"+a,success:t=>{e("deleteFeedback",{feedbackId:a,parentFeedbackId:s,feedback:i})}})}};let d=!1;var o={state:()=>({authenticatedUser:{},counts:{},feedbacks:[],itemAttributes:[],pagination:{isLastPage:!0,lastPage:1,currentPage:1}}),mutations:r,actions:n,getters:{}};function c(e,t){return e.filter((function(e){return e.id!==t}))}function l(e,t,a){return e.map((function(e){return t===e.id&&(e.replies=e.replies.filter((function(e){return e.id!==a}))),e}))}function u(e){let t=0;t+=5*e.counts.ratingsCountOf5,t+=4*e.counts.ratingsCountOf4,t+=3*e.counts.ratingsCountOf3,t+=2*e.counts.ratingsCountOf2,t+=1*e.counts.ratingsCountOf1,t/=e.counts.ratingsCountTotal,e.counts.averageValue=t}var m={created(){this.$store.hasModule("feedback")||App.isSSR||this.$store.registerModule("feedback",o,{preserveState:!!this.$store.state.feedback})}}},9099:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"feedback-container feedback-orderitem-container"},[a("div",{staticClass:"title"},[e._v("\n    "+e._s(e.$translate("Feedback::Feedback.orderItemTitle"))+"\n  ")]),e._v(" "),a("hr"),e._v(" "),e.isLoading?a("div",{staticClass:"w-100 text-center"},[a("p",[e._v(e._s(e.$translate("Feedback::Feedback.loadingItems")))])]):a("div",{staticClass:"feedback-items row"},e._l(e.pagination,(function(t){return a("feedback-order-item",{key:t.variationId,attrs:{item:t,"number-of-columns":e.trueItemsPerRow}})})),1),e._v(" "),!e.isLoading&&e.page*e.options.itemsPerRow*e.options.rowsPerPage<e.orderItems.length?a("button",{staticClass:"btn btn-default btn-block feedback-loadmore",on:{click:function(t){return e.nextPage()}}},[e._v("\n    Weitere Artikel anzeigen\n  ")]):e._e(),e._v(" "),e.isLoading?e._e():a("feedback-order-form",{attrs:{"allow-guest-feedbacks":e.options.allowGuestFeedbacks,"number-of-feedbacks":e.options.numberOfFeedbacks,"access-key":e.accessKey,"order-id":e.orderId,"show-empty-ratings":e.options.showEmptyRatingsInOrderConfirmation}})],1)};s._withStripped=!0;a(7495),a(5440);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"orderItemFeedbackModal",staticClass:"modal fade feedback-orderitem-modal",attrs:{tabindex:"-1",role:"dialog","aria-labelledby":"feedbackOrderItem-"+e._uid,"aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("span",{staticClass:"modal-title h3",attrs:{id:"feedbackConfirmDeleteLabel-"+e._uid}},[e._v(e._s(e.$translate("Feedback::Feedback.customerReviews")))]),e._v(" "),e._m(0)]),e._v(" "),a("div",{staticClass:"modal-body row"},[a("div",{staticClass:"col-4"},[a("a",{attrs:{href:e.item.url}},[a("img",{attrs:{alt:e.item.name,src:e.item.image}})]),e._v(" "),a("div",{staticClass:"stars"},[e._l(e.starIds,(function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.ratingValue,expression:"feedback.ratingValue"}],key:"stars_input_"+t.id,class:t.class,attrs:{id:t.id,type:"radio",disabled:e.isRated,name:"ratingValue"},domProps:{value:t.value,checked:e._q(e.feedback.ratingValue,t.value)},on:{change:function(a){return e.$set(e.feedback,"ratingValue",t.value)}}}),e._v(" "),a("label",{key:"stars_label_"+t.id,staticClass:"new_star",attrs:{for:t.id}},[a("svg",{class:t.class,staticStyle:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"},attrs:{for:t.id,width:"100%",height:"100%",viewBox:"0 0 31 30",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","xmlns:serif":"http://www.serif.com/"}},[a("path",{staticStyle:{"fill-rule":"nonzero"},attrs:{d:"M30.5,11.564c0,0.265 -0.156,0.553 -0.469,0.866l-6.544,6.382l1.55,9.014c0.012,0.085 0.018,0.205 0.018,0.361c0,0.252 -0.063,0.466 -0.189,0.64c-0.126,0.174 -0.31,0.261 -0.55,0.261c-0.228,0 -0.469,-0.072 -0.721,-0.216l-8.095,-4.255l-8.095,4.255c-0.264,0.144 -0.505,0.216 -0.721,0.216c-0.253,0 -0.442,-0.087 -0.568,-0.261c-0.126,-0.174 -0.189,-0.388 -0.189,-0.64c0,-0.072 0.012,-0.192 0.036,-0.361l1.55,-9.014l-6.562,-6.382c-0.301,-0.325 -0.451,-0.613 -0.451,-0.866c0,-0.444 0.337,-0.721 1.01,-0.829l9.05,-1.316l4.057,-8.203c0.228,-0.493 0.522,-0.739 0.883,-0.739c0.361,0 0.655,0.246 0.883,0.739l4.057,8.203l9.05,1.316c0.673,0.108 1.01,0.385 1.01,0.829Z"}})])])]}))],2)]),e._v(" "),a("div",{staticClass:"col-8"},[a("a",{staticClass:"mb-3",attrs:{href:e.item.url}},[e._v(e._s(e.item.name)+"\n            "),e._l(e.item.attributes,(function(t){return[e._v(" | "+e._s(t.attribute.names.name)+": "+e._s(t.value.names.name))]}))],2),e._v(" "),e.authenticatedUser.isLoggedIn?e._e():a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.authorName,expression:"feedback.authorName"}],staticClass:"form-control",attrs:{id:"author",type:"text",name:"author",disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.authorName")},domProps:{value:e.feedback.authorName},on:{input:function(t){t.target.composing||e.$set(e.feedback,"authorName",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.honeypot,expression:"feedback.honeypot"}],staticClass:"form-control",attrs:{id:"feedback-textfield",type:"text",disabled:e.isRated||e.limitReached,name:"feedback-textfield"},domProps:{value:e.feedback.honeypot},on:{input:function(t){t.target.composing||e.$set(e.feedback,"honeypot",t.target.value)}}})]),e._v(" "),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.title,expression:"feedback.title"}],staticClass:"form-control",class:{"is-invalid":e.titleMissing},attrs:{id:"title",type:"text",name:"title",disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.title")},domProps:{value:e.feedback.title},on:{input:function(t){t.target.composing||e.$set(e.feedback,"title",t.target.value)}}}),e._v(" "),a("div",{staticClass:"invalid-feedback"},[e._v("\n              "+e._s(e.$translate("Feedback::Feedback.titleRequired"))+"\n            ")])]),e._v(" "),a("div",{staticClass:"form-group"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.feedback.message,expression:"feedback.message"}],staticClass:"form-control",attrs:{id:"message",name:"message",rows:e.rows,disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.reviewMessage")},domProps:{value:e.feedback.message},on:{input:function(t){t.target.composing||e.$set(e.feedback,"message",t.target.value)}}})])])]),e._v(" "),a("div",{staticClass:"modal-footer"},[e.isRated||e.limitReached?e.limitReached?a("div",{staticClass:"w-100 text-center"},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.maximumNumberOfFeedbacksReached"))+"\n        ")]):a("div",{staticClass:"w-100 text-center"},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.thankYou"))+"\n        ")]):a("button",{staticClass:"btn btn-primary btn-appearance btn-block",attrs:{type:"button",disabled:e.isRated||e.showEmptyRatings&&0===e.feedback.ratingValue},on:{click:function(t){return e.createFeedback()}}},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.submitReview"))+"\n        ")])])])])])};i._withStripped=!0;a(9463);var r=a(5353);function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function d(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var o={name:"FeedbackOrderForm",props:{allowGuestFeedbacks:Boolean,numberOfFeedbacks:Number,accessKey:String,orderId:String,showEmptyRatings:Boolean},data:function(){return{feedback:{ratingValue:0,authorName:"",title:"",message:"",type:"review",targetId:0,honeypot:""},isLoading:!1,isRated:!1,titleMissing:!1,item:{url:"",image:"",variationId:0,name:"",itemId:0,attributes:{}}}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({starIds:function(){const e=[],t=this.isRated?"star-rated":"star";for(let a=5;a>0;a--)e.push({value:a,id:"star-"+a+"-"+this.item.variationId+"-form",class:t});return e},rows:function(){return this.authenticatedUser.id>0?8:6},limitReached:function(){const e=this.item.itemId;return this.authenticatedUser.limitReached[e]}},(0,r.aH)({authenticatedUser:e=>e.feedback.authenticatedUser})),mounted:function(){const e=this;vueEventHub.$on("orderItemFeedback_showform",(function(t){e.prepare(t)}))},methods:{prepare:function(e){this.item=e.item,this.isRated=e.isRated;const t=this;Vue.nextTick((function(){t.feedback=e.feedback,$(t.$refs.orderItemFeedbackModal).modal("show")}))},createFeedback:function(){if(this.isLoading||this.feedback.honeypot.length>0)return;if(!this.feedback.title)return void(this.titleMissing=!0);if(this.limitReached)return;this.isLoading=!0,this.feedback.options=this.options,this.feedback.targetId=this.item.variationId,this.feedback.accessKey=this.accessKey,this.feedback.orderId=this.orderId;const e=this;$.ajax({type:"POST",url:"/rest/feedbacks/feedback/create",data:this.feedback,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",xhrFields:{withCredentials:!0},success:function(t){vueEventHub.$emit("orderItemFeedback_created",{feedback:JSON.parse(JSON.stringify(e.feedback))}),e.isLoading=!1,e.feedback.authorName="",e.feedback.message="",e.feedback.title="",e.feedback.ratingValue=0,e.titleMissing=!1,e.ratingMissing=!1,$(e.$refs.orderItemFeedbackModal).modal("hide")},error:function(t,a,s){console.error(s),e.isLoading=!1}})}}},c=o,l=a(4486),u=(0,l.A)(c,i,[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])])}],!1,null,null,null).exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"feedback-item mb-4",class:"col-12 col-sm-"+12/e.numberOfColumns},[a("div",{staticClass:"stars",on:{click:function(t){return e.handleRating(0)}}},[a("form",[e._l(e.starIds,(function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.ratingValue,expression:"feedback.ratingValue"}],key:"stars_input_"+t.id,class:t.class,attrs:{id:t.id,type:"radio",name:"ratingValue",disabled:e.isRated},domProps:{value:t.value,checked:e._q(e.feedback.ratingValue,t.value)},on:{click:function(a){return e.handleRating(t.value)},change:function(a){return e.$set(e.feedback,"ratingValue",t.value)}}}),e._v(" "),a("label",{key:"stars_label_"+t.id,staticClass:"new_star",attrs:{for:t.id}},[a("svg",{class:t.class,staticStyle:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"},attrs:{for:t.id,width:"100%",height:"100%",viewBox:"0 0 31 30",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","xmlns:serif":"http://www.serif.com/"}},[a("path",{staticStyle:{"fill-rule":"nonzero"},attrs:{d:"M30.5,11.564c0,0.265 -0.156,0.553 -0.469,0.866l-6.544,6.382l1.55,9.014c0.012,0.085 0.018,0.205 0.018,0.361c0,0.252 -0.063,0.466 -0.189,0.64c-0.126,0.174 -0.31,0.261 -0.55,0.261c-0.228,0 -0.469,-0.072 -0.721,-0.216l-8.095,-4.255l-8.095,4.255c-0.264,0.144 -0.505,0.216 -0.721,0.216c-0.253,0 -0.442,-0.087 -0.568,-0.261c-0.126,-0.174 -0.189,-0.388 -0.189,-0.64c0,-0.072 0.012,-0.192 0.036,-0.361l1.55,-9.014l-6.562,-6.382c-0.301,-0.325 -0.451,-0.613 -0.451,-0.866c0,-0.444 0.337,-0.721 1.01,-0.829l9.05,-1.316l4.057,-8.203c0.228,-0.493 0.522,-0.739 0.883,-0.739c0.361,0 0.655,0.246 0.883,0.739l4.057,8.203l9.05,1.316c0.673,0.108 1.01,0.385 1.01,0.829Z"}})])])]}))],2)]),e._v(" "),a("a",{attrs:{href:e.item.url}},[a("img",{staticClass:"py-2",attrs:{alt:e.item.name,src:e.item.image}})]),e._v(" "),a("div",{staticClass:"feedback-item-link"},[a("a",{attrs:{href:e.item.url}},[e._v(e._s(e.item.name))]),e._v(" "),e._l(e.item.attributes,(function(t){return a("div",{key:e.item.itemId+"-"+t.valueId},[a("strong",[e._v(e._s(t.attribute.names.name)+": ")]),e._v(" "),a("span",[e._v(e._s(t.value.names.name))])])}))],2)])};m._withStripped=!0;var b={name:"FeedbackOrderItem",props:{item:Object,numberOfColumns:Number},data(){return{isRated:!1,feedback:{ratingValue:0,authorName:"",title:"",message:"",type:"review",targetId:0,honeypot:""}}},computed:{starIds(){const e=[],t=this.isRated?"star-rated":"star";for(let a=5;a>0;a--)e.push({value:a,id:"star-"+a+"-"+this.item.variationId,class:t});return e},variationAttributes(){return null}},mounted(){vueEventHub.$on("orderItemFeedback_created",(e=>{e.feedback.targetId===this.item.variationId&&(this.feedback=e.feedback,this.isRated=!0)}))},methods:{handleRating(e){!this.isRated&&e>0&&(this.feedback.ratingValue=e),vueEventHub.$emit("orderItemFeedback_showform",{item:this.item,feedback:this.feedback,isRated:this.isRated})}}},f={name:"FeedbackOrder",components:{"feedback-order-form":u,"feedback-order-item":(0,l.A)(b,m,[],!1,null,null,null).exports},mixins:[a(4304).A],props:{variations:Object,items:Array,itemUrls:Object,itemImages:Object,options:Object,splitItemBundles:Number,accessKey:String,orderId:String},data(){return{isLoading:!0,page:1}},computed:{orderItems(){const e=[];for(let t=0;t<this.items.length;t++)if(this.items[t].itemVariationId>0&&-1===this.items[t].orderItemName.indexOf("[-]")){const a=this.items[t].itemVariationId,s=this.variations[a].variation.bundleType,i=this.items[t].orderItemName;if(e.push({name:this.filterItemName(i,s),image:this.itemImages[a],url:this.itemUrls[a],variationId:a,itemId:this.variations[a].item.id,attributes:this.variations[a].attributes}),"bundle"===s&&this.splitItemBundles<1)for(let a=0;a<this.items[t].bundleComponents.length;a++){const s=this.items[t].bundleComponents[a].data.variation.id;e.push({name:this.$options.filters.itemName(this.items[t].bundleComponents[a].data),image:this.itemImages[s],url:this.itemUrls[s],variationId:s,itemId:this.items[t].bundleComponents[a].data.itemId,attributes:this.items[t].bundleComponents[a].data.attributes})}}return e},pagination(){const e=this.page*this.options.itemsPerRow*this.options.rowsPerPage;return this.orderItems.slice(0,e)},trueItemsPerRow(){return Math.min(this.orderItems.length,this.options.itemsPerRow)}},mounted(){$.when(this.getUser()).done((()=>{this.isLoading=!1,Vue.nextTick((()=>{window.dispatchEvent(new Event("resize"))}))}))},methods:{getUser(){const e=[],t=[];for(let a=0;a<this.orderItems.length;a++){const s=this.orderItems[a];e.push(s.itemId),t.push(s.variationId)}const a={itemIds:e,variationIds:t,allowFeedbacksOnlyIfPurchased:!1,numberOfFeedbacks:this.options.numberOfFeedbacks};return this.orderId&&this.accessKey&&(a.orderId=this.orderId,a.accessKey=this.accessKey),this.$store.dispatch("loadFeedbackUser",{data:a,itemId:this.itemId,variationId:this.variationId})},nextPage(){this.page*this.options.itemsPerRow*this.options.rowsPerPage<this.orderItems.length&&(this.page+=1)},filterItemName(e,t){return"bundle"===t?e.replace("[BUNDLE]",""):"bundle_item"===t?e.replace("[-]",""):e}}},h=(0,l.A)(f,s,[],!1,null,null,null).exports}}]);
//# sourceMappingURL=feedback-5.min.js.map